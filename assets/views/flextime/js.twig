<script>
  var uid = {{ uid }};

  require(["jquery", "jquery.jeditable", "bootstrap"], function ($) {
    $('select.js_superedit')
      .val({{ uid }})
      .trigger("change")
      .change(function () {
        location.href = '/flextime/uid/' + $(this).val();
      });
    $("input").on("keypress", function (e) {
      return e.which != 13;
    });
    $('[data-toggle="popover"]').popover({'trigger': 'focus'});

    $('#js_memo').on('change', function () {
      var memo_str = $(this).val();
      if (memo_str.substr(0, 2) == '기타') {
        var memo = prompt('간략하게 사유를 입력해주세요~');
        if (!memo) {
          $(this).val('개인용무');
          return;
        }
        $('option:selected', this)
          .text('기타(' + memo + ')')
          .val('기타(' + memo + ')');
      }
    }).trigger('change');

    $('#js_type').on('change', function () {
      var type_str = $(this).val();
      if (type_str != '오전반차' && type_str != '오후반차' && type_str != 'PWT')
        $('#js_cost').show();
      else
        $('#js_cost').hide();
    }).trigger('change');

    {% if editable %}
    $('.flextime td[data-key]').each(function () {
      var flextimeid = $(this).parent().data('flextimeid');
      var key = $(this).data('key');
      var submitdata = {flextimeid: flextimeid, key: key};
      var args = {submitdata: submitdata, method: 'PUT'};

      var isSelectInput = ($(this).data('keyselect') != undefined);
      if (isSelectInput) {
        args['type'] = 'select';
        args['loadurl'] = '/flextime/const/key/' + key;
        args['submit'] = "OK";
      }

      $(this).editable('/flextime/uid/' + uid, args);
    });
    {% endif %}
  });
</script>
